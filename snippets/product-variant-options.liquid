{% comment %}
  Renders product variant options

  Accepts:
  - product: {Object} product object.
  - option: {Object} current product_option object.
  - block: {Object} block object.
  - picker_type: {String} type of picker to display
{% endcomment %}

{%- liquid
  assign product_form_id = 'product-form-' | append: section.id
-%}

{%- for value in option.values -%}
  {%- liquid
    assign variant_obj = product.variants | where: "title", value | first
    assign color_metaobject = null
    assign swatch_value = null
    assign swatch_focal_point = null

    if variant_obj.metafields.swyfthome.color_image != blank
      assign color_metaobject = variant_obj.metafields.swyfthome.color_image.value
    endif

    if color_metaobject != blank and color_metaobject.button_image != blank
      assign image_url = color_metaobject.button_image | image_url: width: 30
      assign swatch_value = 'url(' | append: image_url | append: ')'
    elsif value.swatch.color
      assign swatch_value = 'rgb(' | append: value.swatch.color.rgb | append: ')'
    endif

    assign option_disabled = true
    if value.available
      assign option_disabled = false
    endif

    assign input_id = section.id | append: '-' | append: option.position | append: '-' | append: forloop.index0
    assign input_name = option.name | append: '-' | append: option.position
    assign input_dataset = 'data-product-url="' | append: value.product_url | append: '" data-option-value-id="' | append: value.id | append: '"'

    assign label_unavailable = '<span class="visually-hidden label-unavailable">' | append: 'products.product.variant_sold_out_or_unavailable' | t | append: '</span>'
  -%}

  {% if picker_type == 'swatch' %}
    {% capture help_text %}
      <span class="visually-hidden">{{ value | escape }}</span>
      {{ label_unavailable }}
    {% endcapture %}
    {% render 'swatch-input',
      id: input_id,
      name: input_name,
      value: value | escape,
      swatch: value.swatch,
      product_form_id: product_form_id,
      checked: value.selected,
      visually_disabled: option_disabled,
      shape: block.settings.swatch_shape,
      help_text: help_text,
      additional_props: input_dataset
    %}
  
{% elsif picker_type == 'button' %}
  <input
    type="radio"
    id="{{ input_id }}"
    name="{{ input_name | escape }}"
    value="{{ value | escape }}"
    form="{{ product_form_id }}"
    {% if value.selected %}checked{% endif %}
    {% if option_disabled %}class="disabled"{% endif %}
    {{ input_dataset }}
    data-variant-id="{{ variant_obj.id }}"
    data-variant-title="{{ variant_obj.title }}"
    data-variant-price="{{ variant_obj.price | money }}"
    data-variant-image="{% if variant_obj.featured_image %}{{ variant_obj.featured_image.src | img_url: '500x' }}{% endif %}"
  >
  <label class="varient-color-picker" for="{{ input_id }}">
    {% if color_metaobject != blank and color_metaobject.button_image != blank %}
      <img class="colour-switch-varient" src="{{ color_metaobject.button_image | image_url: width: 30 }}" width="30" height="30" alt="{{ color_metaobject.name }}">
    {% else %}
      <p class="varient-name">{{ value }}</p>
    {% endif %}
  </label>

  
  {% elsif picker_type == 'dropdown' or picker_type == 'swatch_dropdown' %}
    <option
      id="{{ input_id }}"
      value="{{ value | escape }}"
      {% if value.selected %}selected="selected"{% endif %}
      {% if swatch_value and picker_type == 'swatch_dropdown' %}
        data-option-swatch-value="{{ swatch_value }}"
        {% if swatch_focal_point %}
          data-option-swatch-focal-point="{{ swatch_focal_point }}"
        {% endif %}
      {% endif %}
      {{ input_dataset }}
    >
      {% if option_disabled %}
        {{ 'products.product.value_unavailable' | t: option_value: value }}
      {% else %}
        {{ value }}
      {% endif %}
    </option>
  {% endif %}
{%- endfor -%}
